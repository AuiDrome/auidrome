<!doctype html>
<% remove_link = '<a class="remove" data-key="{{at}}" href="#" title="Remove local copy">REMOVE</a>' %>
<html>
  <head>
    <meta charset="utf-8">
    <title><%= title %></title>
    <link href='http://fonts.googleapis.com/css?family=Carrois+Gothic+SC' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Tangerine">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <script src="/js/jquery-1.11.0.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/mustache.js"></script>

  </head>

  <body>
    <script id="template_piado" type="x-tmpl-mustache">
      <div class="status">
        <img src="/images/{{auido}}.png" onerror="this.src = '/images/frijolito.png'" class="img-thumbnail icon"/>
        <p>somebody is thinking <strong>{{auido}}</strong> and has stored it LOCALLY</p>
        <p>(we hear this thought through our webSockets: nothing is stored NOWHERE ELSE)</p>
      </div>
    </script>
    <script id="template_piado_by_us" type="x-tmpl-mustache">
      <div class="status">
        <img src="/images/{{auido}}.png" onerror="this.src = '/images/frijolito.png'" class="img-thumbnail icon"/>
        <p>you thought <strong>{{auido}}</strong> and stored that thought locally. <%= remove_link %></p>
        <p>(heard it through the server webSockets but nothing was stored nowhere else)</p>
      </div>
    </script>
    <script id="template_tuited" type="x-tmpl-mustache">
      <div class="status">
        <a href="/tuits/{{tuit}}"><img src="/images/{{tuit}}.png" onerror="this.src = '/images/frijolito.png'" alt="{{tuit}} avatar or default avatar" class="img-thumbnail icon"/></a>

        <p><%= App.config.tuit_sentence %></p>
        <p><%= App.config.tuit_consideration %> <%= remove_link %></p>
      </div>
    </script>
    <div class="toolbar">
<% if current_user %>
      You're <strong>@<%= current_user %></strong> in our...
<% else %>
      <a href="http://OTAONY.com">OTAONY.com</a>
<% end %>
    </div>
    <div class="header">
      ❧ <h1><a href="/" title="<%= App.config.site_name %> home"><%= App.config.site_name %></a></h1> ☙
    </div>

<% if flash[:notice] %>
    <div class="notice">
      <div class="notice-inner">
        <%= flash[:notice] %>
      </div>
    </div>
<% end %>

    <%= yield %>

    <div class="dromes-links">
      <div class="dromes-links-inner">
        <% [
             %w{Auidrome AcadoDrome PedaloDrome},
             %w{LoveDrome FictionDrome},
             %w{ByebyeDrome RestoDrome RipoDrome}
           ].each do |dromes| %>
        <div>
          <% dromes.map{|dromename| Auidrome::Config.new(dromename)}.each do |drome| %>
          <a href="http://<%= drome.base_domain %>:<%= drome.port_base %>"><%= drome.site_name %></a>
          <% end %>
        </div>
        <% end %>
      </div>
    </div>

    <div class="footer">
      <div>* <strong><%= App.config.item_name %></strong>: <%= App.config.item_description %></div>
<% if App.config.site_name == 'Auidrome' %>
      <div>Auidrome will be <a href="http://hyperboot.org">hyperbooted</a> and its current source code can be found <a href="http://github.com/AuiDrome/auidrome">here</a>.</div>
<% else %>
      <div><%= App.config.site_name %> is powered by <a href="http://github.com/AuiDrome/auidrome">Auidrome</a>.</div>
<% end %>
    </div>

    <script>
      var socket, host, wshost, template;
      host = '<%= "http://#{request.env['SERVER_NAME']}:#{request.env['SERVER_PORT']}/" %>';
      wshost = 'ws://<%="#{request.env['SERVER_NAME']}:#{request.env['SERVER_PORT'].to_i + 1}" %>';

      // Metemos en alm. local los tuits recibidos desde el servidor
      // (si alguien decidió guardarlo y nosotros sólo lo tenemos en
      //  local el suyo prevalece).
      var tuits_submitted = <%= @tuits_submitted %>;
      for (var tuit in tuits_submitted){
        localStorage.setItem(tuit, tuits_submitted[tuit]);
      }
    </script>

    <script src="/js/general.js"></script>
  </body>
</html>
